<!DOCTYPE html>
<html ng-app="cgtApp" ng-controller="cRessource">
  <head>
    <title>Charoy's Good Trip</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <!-- Bootstrap -->
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/jquery-ui/jquery-ui-1.10.3.custom.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

  </head>

  <body ng-controller="cgtCtrl" >

    <!-- Navbar -->
    <!--
    <header role="banner" class="navbar navbar-fixed-top navbar-default">
      <div class="container">
        <div class="navbar-header">
          <button data-target=".bs-navbar-collapse" data-toggle="collapse" type="button" class="navbar-toggle">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="./">Charoy's Good Trip</a>
        </div>

        <nav role="navigation" class="collapse navbar-collapse bs-navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="#">Link L.</a></li>
            <li><a href="#">Link L.</a></li>
            <li><a href="#">Link L.</a></li>
            <li><a href="#">Link L.</a></li>
            <li><a href="#">Link L.</a></li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li><a href="#">Link R.</a></li>
            <li><a href="#">Link R.</a></li>
            <li><a href="#">Link R.</a></li>
            <li><a href="#">Link R.</a></li>
            <li><a href="#">Link R.</a></li>
          </ul>          
        </nav>
      </div>
    </header>
    -->
    <!-- Navbar -->

    <div ng-controller="atriumCtrl">

          <input type="text" ng-model="hashRoom"></input>
          <button ng-click="readRoom(hashRoom)">join Room</button>
          <button ng-click="createRoom()">create Room</button>

    </div>

     <div ng-controller="roomCtrl">
          <span>{{room.hash}}</span>
          <input type="text" ng-model="room.name" ng-change="op.save(room,url())"></input>

          <button ng-click="createTrip()">create Trip</button>

          <div ng-controller="tripCtrl" ng-repeat="trip in room.trips">
            trip name : <input type="text" ng-model="trip.name" ng-change="op.save(trip,url())"></input> | <input type="text" ng-model="trip.city" ng-change="op.save(trip,url())"></input>

            <div ng-controller="acomodationCtrl" ng-repeat="acomodation in trip.acomodations">
              <span>&nbsp;&nbsp;&nbsp;{{acomodation.price}}</span>
            </div>
          </div>

          <div ng-repeat="user in room.users">
             user name : <input type="text" ng-model="user.name"></input>
          </div>

    </div>

    <!-- Container -->
    <div class="container" ng-controller="roomCtrl">

        

       
        
      

      <!-- Search Menu -->
	  <div class="row">
		  <div class="cgt-block cgt-block-gris">
			<form role="form" id="search-form" ng-submit="search()">
			  <div class="col-lg-4">
				<input type="text" class="form-control input-lg" id="search_location" ng-model="search_location" placeholder="Where do you want to go ?" autocomplete="off" />
			  </div>

			  <div class="col-lg-2">
				<div class="input-group">
				  <input type="text" class="form-control input-lg" id="search_check_in" ng-model="search_check_in" placeholder="Check in" autocomplete="off" />
				  <span class="input-group-addon glyphicon glyphicon-calendar"></span>
				</div>            
			  </div>

			  <div class="col-lg-2">
				<div class="input-group">
				  <input type="text" class="form-control input-lg" id="search_check_out" ng-model="search_check_out" placeholder="Check out" autocomplete="off" />
				  <span class="input-group-addon glyphicon glyphicon-calendar"></span>
				</div>
			  </div>

			  <div class="col-lg-2">
				<select class="form-control input-lg" id="search_nb_guest" ng-init="search_nb_guests=1" data-ng-model="search_nb_guests">
				  <option value="1">1 guest</option>
				  <option value="2">2 guests</option>
				  <option value="3">3+ guests</option>
				</select>
			  </div>

			  <div class="col-lg-2">
				<input type="submit" class="hidden">
				<button type="button" id="search-submit" ng-click="search()" class="btn btn-default btn-lg btn-block"><span class="glyphicon glyphicon-search"></span> Search</button>
			  </div>
			</form>
		  </div>
	  </div>
      <!-- /Search Menu -->


      <!-- Google Map -->
      <div class="row">
        <div class="cgt-block cgt-block-blanc">
          <div class="col-lg-12">
            <div id="cgt-gl-map" style="width:100%; height:400px"></div>
          </div>
        </div>
      </div>
      <!-- /Google Map -->


      <div class="row">
        <div class="cgt-block cgt-block-vert">
          <div class="col-lg-12">
            <div class="page-header">
              <h4>City : {{search_location}}, Date : , People :  {{search_nb_guests}}</h4>
            </div>
          </div>
        </div>
      </div>


      <div class="row">
        <div class="cgt-block cgt-block-blanc voyage_velo" ng-class="{cache : !search_location}">
          <img src="./img/icone-velo.jpg" alt="velo" class="img-voiture"/>


          <span id="voyage-velo">Voyager en vélo</span>

          <div id="voyage-velo-details" style="display: inline;">
            , <span class="glyphicon glyphicon-time"></span> <span id="voyage-velo-temps"></span>
            <span class="glyphicon glyphicon-map-marker"></span> <span id="voyage-velo-distance"></span>
          </div>

          <button id="button_voyager_velo" class="details" ng-click="details_velo=!details_velo" ng-class="{reduire : details_velo}"></button>
          <div id="itineraire-velo-texte" ng-class="{cache : !details_velo}"></div>

        </div>
      </div>


      <div class="row">
        <div class="cgt-block cgt-block-blanc voyage_voiture" ng-class="{cache : !search_location}">
          <img src="./img/icone-voiture.png" alt="voiture" class="img-voiture"/>

          <span id="voyage-voiture">Voyager en voiture</span>

          <div id="voyage-voiture-details" style="display: inline;">
            , <span class="glyphicon glyphicon-time"></span> <span id="voyage-voiture-temps"></span>
            <span class="glyphicon glyphicon-map-marker"></span> <span id="voyage-voiture-distance"></span>
          </div>

          <button id="button_voyager" class="details" ng-click="details_voiture=!details_voiture" ng-class="{reduire : details_voiture}"></button>
          <div id="itineraire-voiture-texte" ng-class="{cache : !details_voiture}"></div>
        </div>
      </div>
	  
    

    

	<!--
      <div class="row">
        <div class="cgt-block cgt-block-violet">
          <div class="col-lg-12">
            <div class="page-header">
              <h4>Icônes utiles ?</h4>
            </div>

            <p>
              <span class="glyphicon glyphicon-signal"></span> Wifi
              <br />

              <span class="glyphicon glyphicon-road"></span> Parking
              <br />

              <span class="glyphicon glyphicon-thumbs-up"></span> Nice
              <br />

              <span class="glyphicon glyphicon-thumbs-down"></span> That sux
              <br />

              <span class="glyphicon glyphicon-usd"></span> $$$ :3
              <br />

              <span class="glyphicon glyphicon-plane"></span> (✿ ^.^)✿●•٠·˙
              <br />

              <span class="glyphicon glyphicon-globe"></span> The World is mine ★•  ♫♫  *♥*  ♫♫  •★
              <br />
            </p>
          </div>
        </div>
      </div>
		-->
      
      <!-- Template Item -->
      <div class="row">
        <div ng-repeat="item in items" class="cgt-block cgt-block-blanc">
          <div class="col-lg-12">
            <div class="page-header">
              {{item.typeAlias.propType}} in {{item.origin}}, {{item.country}} for {{item.occupancy}} people
            </div>

            <div class="page-container">
              <img src="{{item.photos[0].url}}" alt="" class="img-container"/>

              <div class="desc-container">
                <ul>
                  <li><span class="glyphicon glyphicon-globe"></span> Localisation : ({{item.latLng[0]}}, {{item.latLng[1]}})</li>
                  <li>Type of room : {{item.typeAlias.roomType}}</li>
                  <li><span class="glyphicon glyphicon-usd"></span> Price : ${{item.price}}</li>
                  <li>
                    <span class="glyphicon glyphicon-signal"></span> Wifi : 
                    <span class="glyphicon glyphicon-ok" ng-class="{cache : item.amenities.indexOf('wifi') == -1}"></span>
                    <span class="glyphicon glyphicon-remove" ng-class="{cache : item.amenities.indexOf('wifi') > -1}"></span>
                  </li>
                  <li>
                    <span class="glyphicon glyphicon-road"></span> Parking : 
                    <span class="glyphicon glyphicon-ok" ng-class="{cache : item.amenities.indexOf('parking') == -1}"></span>
                    <span class="glyphicon glyphicon-remove" ng-class="{cache : item.amenities.indexOf('parking') > -1}"></span></li>
                </ul>
              </div>

              <div class="options-container">
                Vote :
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- /Template Item -->

    </div>
    <!-- /Container -->



    <!--<script src="socket.io/socket.io.js"></script>-->
    <script src="bower_components/jquery/jquery.min.js"></script>
    <script src="bower_components/jquery-ui/ui/minified/jquery-ui.min.js"></script>



    <script>
      $('#search_check_in').datepicker({
        minDate: 0,
        numberOfMonths: 2
      });
      $('#search_check_out').datepicker({
        minDate: 0,
        numberOfMonths: 2
      });
    </script>

    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <script src="bower_components/angular/angular.min.js"></script>
    <script src="bower_components/angular-route/angular-route.min.js"></script>

    <script src="js/controllers.js"></script>
    <script src="js/directives.js"></script>
    <script src="js/services.js"></script>
    <script src="js/filters.js"></script>
    <script src="js/app.js"></script>

	  <script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>


    <script>
    (function() {

      var cgt_map = {};

      cgt_map.Utils = {
        options: {
          zoom: 5,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          center: new google.maps.LatLng(48.85, 2.35)
        },

        init: function() {
          this.geo = new google.maps.Geocoder();
          this.map = new google.maps.Map(document.getElementById('cgt-gl-map'), this.options)
        },

        _update: function(location) {
          cgt_map.Utils.geo.geocode({
            'address': location
          },
          function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
              cgt_map.Utils.map.setCenter(results[0].geometry.location);

              if (cgt_map.Utils.marker) {
                cgt_map.Utils.marker.setMap(null);
              }

              cgt_map.Utils.marker = new google.maps.Marker({
                map: cgt_map.Utils.map,
                position: results[0].geometry.location
              });
            }
          });
        } 
      };

      cgt_map.Utils.init();


      cgt_map.Itineraire = {
        options_velo: {
          panel: document.getElementById("itineraire-velo-texte")
        },

        options_voiture: {
          map: cgt_map.Utils.map,
          panel: document.getElementById("itineraire-voiture-texte")
        },      

        init: function () {
          this.itineraireService = new google.maps.DirectionsService();
          this.itineraireAffichage_Velo = new google.maps.DirectionsRenderer(this.options_velo);
          this.itineraireAffichage_Voiture = new google.maps.DirectionsRenderer(this.options_voiture);
        },
        
        _update: function(location) {
  
          var itineraireRequete_Velo = {
            origin: "Nancy, FR",
            destination: location,
            travelMode: google.maps.TravelMode.BICYCLING
          };

          var itineraireRequete_Voiture = {
            origin: "Nancy, FR",
            destination: location,
            travelMode: google.maps.TravelMode.DRIVING 
          };   


          this.itineraireService.route(itineraireRequete_Velo, function(itineraireResultat, itineraireCodeStatut) {
            if (itineraireCodeStatut === google.maps.DirectionsStatus.OK) {
              cgt_map.Itineraire.itineraireAffichage_Velo.setDirections(itineraireResultat);

              $('#voyage-velo-details').show();
              document.getElementById('voyage-velo-temps').innerHTML = itineraireResultat.routes[0].legs[0].duration.text;
              document.getElementById('voyage-velo-distance').innerHTML = itineraireResultat.routes[0].legs[0].distance.text;
            }
            else
            {
              $('#voyage-velo-details').hide();
              document.getElementById('voyage-velo').innerHTML = "Ce voyage n'est pas possible en voiture";
              document.getElementById('button_voyager_velo').disabled = true;
              document.getElementById('button_voyager_velo').className = "reduire";
            }
          });


          this.itineraireService.route(itineraireRequete_Voiture, function(itineraireResultat, itineraireCodeStatut) {
            if (itineraireCodeStatut === google.maps.DirectionsStatus.OK) {
              cgt_map.Itineraire.itineraireAffichage_Voiture.setDirections(itineraireResultat);

              $('#voyage-voiture-details').show();
              document.getElementById('voyage-voiture-temps').innerHTML = itineraireResultat.routes[0].legs[0].duration.text;
              document.getElementById('voyage-voiture-distance').innerHTML = itineraireResultat.routes[0].legs[0].distance.text;
             
            }
            else
            {
              $('#voyage-voiture-details').hide();
              document.getElementById('voyage-voiture').innerHTML = "Ce voyage n'est pas possible en voiture";
              document.getElementById('button_voyager').disabled = true;
              document.getElementById('button_voyager').className = "reduire";
            }
          });

        }
      };

      cgt_map.Itineraire.init();


      $('#voyage-velo-details').hide();
      $('#voyage-voiture-details').hide();











      $('#search-form').submit(function() {
        var location = $('#search_location').val();

        cgt_map.Utils._update(location);
        cgt_map.Itineraire._update(location);
      });

      $('#search-submit').click(function() {
        var location = $('#search_location').val();

        cgt_map.Utils._update(location);
        cgt_map.Itineraire._update(location);
      });

    })();
    </script>
  </body>
</html>
